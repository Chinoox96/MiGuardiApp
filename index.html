<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Guardias 24x48</title>
  <meta name="theme-color" content="#0f172a" />

  <!-- Manifest externo -->
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/icon-192.png" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <!-- Estilos básicos embebidos -->
  <style>
    body {
      margin:0; font-family:sans-serif; background:#0f172a; color:#f1f5f9;
    }
    header {
      display:flex; align-items:center; justify-content:space-between;
      padding:8px 12px; background:#0b1220; border-bottom:1px solid #1f2937;
    }
    button {
      background:#1e293b; color:#f1f5f9; border:none; padding:6px 12px;
      border-radius:8px; cursor:pointer;
    }
    button:active { background:#334155; }
    .calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:4px; padding:8px; }
    .day { aspect-ratio:1/1; display:flex; align-items:center; justify-content:center;
      border-radius:6px; background:#1e293b; font-size:14px; cursor:pointer; }
    .day.today { outline:2px solid #34d399; }
    .day.selected { outline:2px solid #22c55e; }
    .tabs { display:flex; gap:8px; padding:8px; }
    .tab { flex:1; text-align:center; padding:8px; border-radius:8px; cursor:pointer; }
    .tab.active { background:#0284c7; }
    .content { padding:8px; }
    input, select {
      margin:4px 0; padding:4px; border-radius:4px; border:1px solid #334155;
      background:#0f172a; color:#f1f5f9;
    }
    table { border-collapse:collapse; width:100%; margin-top:8px; }
    th, td { border:1px solid #334155; padding:6px; text-align:left; }
  </style>
</head>
<body>
  <header>
    <button id="prev">◀</button>
    <div id="monthLabel">Mes Año</div>
    <button id="next">▶</button>
  </header>

  <div class="calendar" id="calendar"></div>

  <div class="tabs">
    <div id="tab-guardia" class="tab active">Guardia</div>
    <div id="tab-poblacion" class="tab">Población</div>
  </div>
  <div class="content" id="tabContent"></div>

  <!-- Script de la App -->
  <script>
    const calendarEl = document.getElementById('calendar');
    const monthLabel = document.getElementById('monthLabel');
    const tabContent = document.getElementById('tabContent');
    const today = new Date(); today.setHours(0,0,0,0);
    let selectedDate = today;
    let cursor = new Date(today.getFullYear(), today.getMonth(), 1);
    let activeTab = 'guardia';

    function ymd(d){ return d.toISOString().slice(0,10); }

    function renderCalendar(){
      calendarEl.innerHTML = '';
      monthLabel.textContent = cursor.toLocaleDateString('es-ES',{month:'long',year:'numeric'});
      const start = new Date(cursor.getFullYear(), cursor.getMonth(),1);
      const startDay = (start.getDay()+6)%7; // lunes=0
      const first = new Date(start); first.setDate(first.getDate()-startDay);
      for(let i=0;i<42;i++){
        const d = new Date(first); d.setDate(first.getDate()+i);
        const div = document.createElement('div');
        div.className='day';
        if(d.toDateString()===today.toDateString()) div.classList.add('today');
        if(d.toDateString()===selectedDate.toDateString()) div.classList.add('selected');
        div.textContent=d.getDate();
        div.onclick=()=>{ selectedDate=d; renderCalendar(); renderTab(); };
        calendarEl.appendChild(div);
      }
    }

    function renderTab(){
      if(activeTab==='guardia'){
        tabContent.innerHTML=`
          <h3>${selectedDate.toLocaleDateString('es-ES',{weekday:'long',day:'numeric',month:'long'})}</h3>
          <label>Pabellón: <input></label><br>
          <label>Rol (Celador/Auxiliar): <input></label><br>
          <label>Población total: <input type="number"></label><br>
          <label>Condenados: <input type="number"></label><br>
          <label>Procesados: <input type="number"></label><br>
          <label>Presentes: <input type="number"></label><br>
          <label>Hospitalizados: <input type="number"></label><br>
        `;
      } else {
        tabContent.innerHTML=`
          <h3>Población</h3>
          <table>
            <tr><th>Matrícula</th><th>C/P</th><th>Apellido y Nombre</th></tr>
            <tr>
              <td><input></td>
              <td><select><option>C</option><option>P</option></select></td>
              <td><input></td>
            </tr>
          </table>
        `;
      }
    }

    document.getElementById('prev').onclick=()=>{ cursor.setMonth(cursor.getMonth()-1); renderCalendar(); };
    document.getElementById('next').onclick=()=>{ cursor.setMonth(cursor.getMonth()+1); renderCalendar(); };

    document.getElementById('tab-guardia').onclick=()=>{ activeTab='guardia'; document.getElementById('tab-guardia').classList.add('active'); document.getElementById('tab-poblacion').classList.remove('active'); renderTab(); };
    document.getElementById('tab-poblacion').onclick=()=>{ activeTab='poblacion'; document.getElementById('tab-poblacion').classList.add('active'); document.getElementById('tab-guardia').classList.remove('active'); renderTab(); };

    renderCalendar(); renderTab();

    // === Registrar Service Worker ===
    if('serviceWorker' in navigator){
      window.addEventListener('load', ()=>{
        navigator.serviceWorker.register('./sw.js')
        .then(reg=>console.log('SW registrado', reg))
        .catch(err=>console.error('SW fallo', err));
      });
    }
  </script>
</body>
</html>
